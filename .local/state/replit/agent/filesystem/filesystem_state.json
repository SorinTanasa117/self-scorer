{"file_contents":{"app.js":{"content":"import {\n    onAuthStateChange,\n    logoutUser,\n    addPositive,\n    getAllPositives,\n    getPositiveById,\n    getPositivesByDate,\n    getPositivesByDateRange,\n    updatePositive,\n    deletePositive,\n    addCustomTemplate,\n    getAllCustomTemplates,\n    getCustomTemplateByName,\n    updateCustomTemplate,\n} from './auth.js';\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    // --- DOM Elements ---\n    const homePage = document.getElementById('home-page');\n    const addPositivePage = document.getElementById('add-positive-page');\n    const useTemplatePage = document.getElementById('use-template-page');\n\n    // Auth\n    const signoutBtn = document.getElementById('signout-btn');\n\n    // Home Page\n    const addPositiveBtnHome = document.getElementById('add-positive-btn-home');\n    const useTemplateBtn = document.getElementById('use-template-btn');\n    const monthSelector = document.getElementById('month-selector');\n    const yearSelector = document.getElementById('year-selector');\n    const calendarEl = document.getElementById('calendar');\n    const positivesListEl = document.getElementById('positives-list');\n    const dailyLogTitleEl = document.getElementById('daily-log-title');\n    const chartCanvas = document.getElementById('progress-chart');\n    const verbChartCanvas = document.getElementById('verb-chart');\n\n    // Add Positive Page\n    const addPositiveForm = document.getElementById('add-positive-form');\n    const cancelPositiveBtn = document.getElementById('cancel-positive-btn');\n    const saveTemplateBtn = document.getElementById('save-template-btn');\n    const difficultySlider = document.getElementById('positive-difficulty');\n    const difficultyValue = document.getElementById('difficulty-value');\n    const difficultyHelpIcon = document.getElementById('difficulty-help-icon');\n    const difficultyTooltip = document.getElementById('difficulty-tooltip');\n    const closeTooltipBtn = document.getElementById('close-tooltip-btn');\n    const positiveNameInput = document.getElementById('positive-name');\n    const positiveTemplatesInput = document.getElementById('positive-templates-input');\n    const standardTemplatesOptions = document.getElementById('standard-templates-options');\n    const myPositiveTemplatesInput = document.getElementById('my-positive-templates-input');\n    const myTemplatesOptions = document.getElementById('my-templates-options');\n\n    // Use Template Page\n    const templateMonthSelector = document.getElementById('template-month-selector');\n    const templateYearSelector = document.getElementById('template-year-selector');\n    const templateCalendarEl = document.getElementById('template-calendar');\n    const templateDayPositivesListEl = document.getElementById('template-day-positives-list');\n    const templateMasterListEl = document.getElementById('template-master-list');\n    const searchMasterListInput = document.getElementById('search-master-list');\n    const templateSelectAllBtn = document.getElementById('template-select-all-btn');\n    const saveFromTemplateBtnTop = document.getElementById('save-from-template-btn');\n    const saveFromTemplateBtnBottom = document.getElementById('save-from-template-btn-bottom');\n    const cancelFromTemplateBtn = document.getElementById('cancel-from-template-btn');\n\n    // --- State ---\n    let currentUser = null;\n    let selectedDate = new Date().toISOString().split('T')[0];\n    let currentMonth = new Date().getMonth();\n    let currentYear = new Date().getFullYear();\n    let templatePageMonth = currentMonth;\n    let templatePageYear = currentYear;\n    let myChart;\n    let verbChart;\n    let myTemplates = [];\n\n    // --- Templates ---\n    const standardTemplates = [\n        \"Displayed affection towards a lover in public.\", \"Showed affection towards friends by hugging when you leave.\", \"Said 'thank you' to a service worker.\", \"Held the door open for someone.\", \"Completed a difficult task at work.\", \"Woke up on time.\", \"Ate a healthy meal.\", \"Exercised for 30 minutes.\", \"Read a chapter of a book.\", \"Learned something new.\", \"Helped a colleague with a problem.\", \"Called a family member to catch up.\", \"Listened to a friend without judgment.\", \"Forgave someone.\", \"Apologized for a mistake.\", \"Set a boundary with someone.\", \"Said 'no' to something you didn't want to do.\", \"Donated to a charity.\", \"Volunteered your time.\", \"Cleaned a part of your home.\",\n    ];\n\n    // --- Page Navigation & UI Updates ---\n    const showPage = async (pageToShow) => {\n        [homePage, addPositivePage, useTemplatePage].forEach(page => {\n            if (page === pageToShow) {\n                page.classList.remove('hidden');\n            } else {\n                page.classList.add('hidden');\n            }\n        });\n        if (pageToShow === homePage) {\n            await refreshHomePage();\n        }\n    };\n\n    const showAddPositivePage = () => {\n        showPage(addPositivePage);\n        addPositiveForm.reset();\n        // Explicitly reset the slider's value to 5\n        difficultySlider.value = 5;\n        difficultyValue.textContent = '5';\n        positiveNameInput.disabled = false;\n        positiveTemplatesInput.disabled = false;\n        myPositiveTemplatesInput.disabled = false;\n        difficultySlider.disabled = false;\n        difficultyTooltip.classList.remove('visible'); // Ensure tooltip is hidden\n    };\n\n    const refreshHomePage = async () => {\n        await renderCalendar(currentMonth, currentYear);\n        await renderPositivesForDay(selectedDate);\n        const activeRange = document.querySelector('.toggle-btn.active').dataset.range;\n        await renderChart(activeRange);\n        await renderVerbChart();\n    };\n\n    // --- Event Listeners ---\n    addPositiveBtnHome.addEventListener('click', showAddPositivePage);\n    useTemplateBtn.addEventListener('click', () => {\n        showPage(useTemplatePage);\n        initializeUseTemplatePage();\n    });\n    cancelPositiveBtn.addEventListener('click', async () => await showPage(homePage));\n    cancelFromTemplateBtn.addEventListener('click', async () => await showPage(homePage));\n\n    monthSelector.addEventListener('change', async () => {\n        currentMonth = parseInt(monthSelector.value, 10);\n        selectedDate = new Date(Date.UTC(currentYear, currentMonth, 1)).toISOString().split('T')[0];\n        updateButtonStates();\n        await refreshHomePage();\n    });\n\n    yearSelector.addEventListener('change', async () => {\n        currentYear = parseInt(yearSelector.value, 10);\n        selectedDate = new Date(Date.UTC(currentYear, currentMonth, 1)).toISOString().split('T')[0];\n        updateButtonStates();\n        await refreshHomePage();\n    });\n\n    difficultySlider.addEventListener('input', () => {\n        difficultyValue.textContent = difficultySlider.value;\n    });\n\n    difficultyHelpIcon.addEventListener('click', (e) => {\n        e.stopPropagation(); // Prevent the document click listener from firing\n        difficultyTooltip.classList.toggle('visible');\n    });\n\n    closeTooltipBtn.addEventListener('click', () => {\n        difficultyTooltip.classList.remove('visible');\n    });\n\n    // --- Custom Dropdown Logic ---\n    const renderDropdown = (container, items) => {\n        container.innerHTML = '';\n        items.forEach(item => {\n            const optionEl = document.createElement('span');\n            optionEl.classList.add('dropdown-option');\n            optionEl.textContent = typeof item === 'string' ? item : item.name;\n            optionEl.dataset.value = typeof item === 'string' ? item : item.name;\n            container.appendChild(optionEl);\n        });\n        container.classList.add('visible');\n    };\n\n    const setupDropdown = (input, optionsContainer, getSourceArray, onSelectCallback) => {\n        input.addEventListener('focus', () => {\n            const sourceArray = getSourceArray();\n            const filtered = sourceArray.filter(item => (typeof item === 'string' ? item : item.name).toLowerCase().includes(input.value.toLowerCase()));\n            renderDropdown(optionsContainer, filtered);\n        });\n\n        input.addEventListener('input', () => {\n            const sourceArray = getSourceArray();\n            const filtered = sourceArray.filter(item => (typeof item === 'string' ? item : item.name).toLowerCase().includes(input.value.toLowerCase()));\n            renderDropdown(optionsContainer, filtered);\n            if (onSelectCallback) {\n                onSelectCallback(input.value);\n            }\n        });\n\n        optionsContainer.addEventListener('click', (e) => {\n            if (e.target.classList.contains('dropdown-option')) {\n                input.value = e.target.dataset.value;\n                optionsContainer.classList.remove('visible');\n                const event = new Event('input', { bubbles: true });\n                input.dispatchEvent(event);\n            }\n        });\n    };\n\n    document.addEventListener('click', (e) => {\n        if (!e.target.closest('.custom-dropdown-container')) {\n            standardTemplatesOptions.classList.remove('visible');\n            myTemplatesOptions.classList.remove('visible');\n        }\n        if (!e.target.closest('.form-group')) {\n            difficultyTooltip.classList.remove('visible');\n        }\n    });\n\n    // --- Form Logic Listeners ---\n    positiveNameInput.addEventListener('input', () => {\n        const hasText = positiveNameInput.value.trim() !== '';\n        positiveTemplatesInput.disabled = hasText;\n        myPositiveTemplatesInput.disabled = hasText;\n    });\n\n    saveTemplateBtn.addEventListener('click', async () => {\n        // A template is identified by the value in one of the two template inputs,\n        // or the main name input if creating a new one.\n        const name = myPositiveTemplatesInput.value.trim() || positiveNameInput.value.trim();\n        const score = parseInt(difficultySlider.value, 10);\n\n        if (!name) {\n            alert('Please enter a name for your new template, or select an existing template to update.');\n            return;\n        }\n\n        const existingTemplate = await getCustomTemplateByName(name);\n\n        if (existingTemplate) {\n            // Update existing template\n            existingTemplate.score = score;\n            await updateCustomTemplate(existingTemplate);\n            alert(`Template \"${name}\" updated!`);\n        } else {\n            // Add new template\n            const newTemplate = { name, score };\n            await addCustomTemplate(newTemplate);\n            alert(`Template \"${name}\" saved!`);\n        }\n        await populateMyTemplates();\n    });\n\n    addPositiveForm.addEventListener('submit', async (e) => {\n        e.preventDefault();\n        let name = positiveNameInput.value.trim() || myPositiveTemplatesInput.value.trim() || positiveTemplatesInput.value.trim();\n        if (!name) {\n            alert(\"Please provide a name or select a template.\");\n            return;\n        }\n        const newPositiveData = {\n            name: name, date: selectedDate, score: parseInt(difficultySlider.value, 10),\n            baseScore: parseInt(difficultySlider.value, 10), count: 1\n        };\n        const newPositive = await addPositive(newPositiveData);\n        if (newPositive && !newPositive.error) {\n            await showPage(homePage);\n        } else {\n            alert('Failed to add positive. Please try again.');\n        }\n    });\n\n    positivesListEl.addEventListener('click', async (e) => {\n        const target = e.target;\n        if (!target.matches('.inc-btn, .dec-btn')) return;\n        const id = target.getAttribute('data-id');\n        if (!id) return;\n        const positive = await getPositiveById(id);\n        if (!positive) return;\n        let shouldUpdate = true;\n        if (target.classList.contains('inc-btn')) {\n            positive.count++;\n            positive.score = positive.baseScore * positive.count;\n        } else if (target.classList.contains('dec-btn')) {\n            if (positive.count > 1) {\n                positive.count--;\n                positive.score = positive.baseScore * positive.count;\n            } else {\n                if (confirm(\"Do you wish to delete this positive?\")) {\n                    await deletePositive(id);\n                    shouldUpdate = false;\n                } else {\n                    return;\n                }\n            }\n        }\n        if (shouldUpdate) {\n            await updatePositive(positive);\n        }\n        await refreshHomePage();\n    });\n\n    calendarEl.addEventListener('click', async (e) => {\n        const dayCell = e.target.closest('.calendar-day');\n        if (dayCell && dayCell.dataset.date) {\n            selectedDate = dayCell.dataset.date;\n            updateButtonStates();\n            await renderPositivesForDay(selectedDate);\n            await renderCalendar(currentMonth, currentYear);\n            const activeRange = document.querySelector('.toggle-btn.active').dataset.range;\n            await renderChart(activeRange);\n        }\n    });\n\n    document.querySelectorAll('.toggle-btn').forEach(btn => {\n        btn.addEventListener('click', async (e) => {\n            document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));\n            e.target.classList.add('active');\n            const range = e.target.getAttribute('data-range');\n            await renderChart(range);\n        });\n    });\n\n    // --- Use Template Page Listeners ---\n    templateMonthSelector.addEventListener('change', () => {\n        templatePageMonth = parseInt(templateMonthSelector.value, 10);\n        renderTemplateCalendar(templatePageMonth, templatePageYear);\n    });\n    templateYearSelector.addEventListener('change', () => {\n        templatePageYear = parseInt(templateYearSelector.value, 10);\n        renderTemplateCalendar(templatePageMonth, templatePageYear);\n    });\n    templateCalendarEl.addEventListener('click', async (e) => {\n        const dayCell = e.target.closest('.calendar-day');\n        if (dayCell && dayCell.dataset.date) {\n            const dateStr = dayCell.dataset.date;\n            const dateParts = dateStr.split('-');\n            const formattedDate = `${dateParts[2]}-${dateParts[1]}-${dateParts[0]}`;\n            document.getElementById('template-day-title').textContent = `${formattedDate}'s Positives`;\n            const positives = await getPositivesByDate(dateStr);\n            templateDayPositivesListEl.innerHTML = '';\n            if (positives.length === 0) {\n                templateDayPositivesListEl.innerHTML = '<li>No positives for this day.</li>';\n                return;\n            }\n            positives.forEach(p => {\n                const li = document.createElement('li');\n                li.innerHTML = `<label><input type=\"checkbox\" data-name=\"${p.name}\" data-score=\"${p.score}\"> ${p.name}</label>`;\n                templateDayPositivesListEl.appendChild(li);\n            });\n        }\n    });\n    templateSelectAllBtn.addEventListener('click', () => {\n        const allCheckboxes = templateDayPositivesListEl.querySelectorAll('input[type=\"checkbox\"]');\n        const isSelectedAll = templateSelectAllBtn.textContent === 'Deselect All';\n\n        allCheckboxes.forEach(box => {\n            box.checked = !isSelectedAll;\n        });\n\n        templateSelectAllBtn.textContent = isSelectedAll ? 'Select All' : 'Deselect All';\n    });\n\n    const saveFromTemplate = async () => {\n        const selectedItems = new Map();\n        templateDayPositivesListEl.querySelectorAll('input:checked').forEach(box => {\n            if (!selectedItems.has(box.dataset.name)) {\n                selectedItems.set(box.dataset.name, parseInt(box.dataset.score, 10));\n            }\n        });\n        templateMasterListEl.querySelectorAll('input:checked').forEach(box => {\n            if (!selectedItems.has(box.dataset.name)) {\n                selectedItems.set(box.dataset.name, parseInt(box.dataset.score, 10));\n            }\n        });\n        for (const [name, score] of selectedItems) {\n            const newPositive = {\n                name, score, date: selectedDate, baseScore: score, count: 1\n            };\n            await addPositive(newPositive);\n        }\n        showPage(homePage);\n    };\n\n    saveFromTemplateBtnTop.addEventListener('click', saveFromTemplate);\n    saveFromTemplateBtnBottom.addEventListener('click', saveFromTemplate);\n\n    // --- Rendering & Helper Functions ---\n    const populateMainSelectors = () => {\n        const months = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"];\n        monthSelector.innerHTML = '';\n        months.forEach((month, index) => {\n            const option = document.createElement('option');\n            option.value = index;\n            option.textContent = month;\n            monthSelector.appendChild(option);\n        });\n        const startYear = 2024;\n        const endYear = new Date().getFullYear() + 5;\n        for (let i = startYear; i <= endYear; i++) {\n            const option = document.createElement('option');\n            option.value = i;\n            option.textContent = i;\n            yearSelector.appendChild(option);\n        }\n    };\n    const updateMainSelectors = () => {\n        monthSelector.value = currentMonth;\n        yearSelector.value = currentYear;\n    };\n    const renderCalendar = async (month, year) => {\n        calendarEl.innerHTML = '';\n        updateMainSelectors();\n        const dayNames = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];\n        dayNames.forEach(day => {\n            const dayNameEl = document.createElement('div');\n            dayNameEl.textContent = day;\n            dayNameEl.classList.add('calendar-day-name');\n            calendarEl.appendChild(dayNameEl);\n        });\n        const firstDay = new Date(Date.UTC(year, month, 1)).getUTCDay();\n        const emptyCells = (firstDay === 0) ? 6 : firstDay - 1;\n        for (let i = 0; i < emptyCells; i++) {\n            const emptyCell = document.createElement('div');\n            emptyCell.classList.add('day');\n            calendarEl.appendChild(emptyCell);\n        }\n        const daysInMonth = new Date(year, month + 1, 0).getDate();\n        const scoresByDate = {};\n        if (currentUser) {\n            const startDate = `${year}-${String(month + 1).padStart(2, '0')}-01`;\n            const endDate = `${year}-${String(month + 1).padStart(2, '0')}-${String(daysInMonth).padStart(2, '0')}`;\n            try {\n                const monthPositives = await getPositivesByDateRange(startDate, endDate);\n                monthPositives.forEach(p => {\n                    scoresByDate[p.date] = (scoresByDate[p.date] || 0) + p.score;\n                });\n            } catch (error) {\n                console.error(\"Could not fetch calendar data. Rendering empty calendar.\", error);\n            }\n        }\n        for (let i = 1; i <= daysInMonth; i++) {\n            const dayCell = document.createElement('button');\n            dayCell.classList.add('calendar-day', 'day');\n            const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;\n            dayCell.dataset.date = dateStr;\n            let dayContent = `<span class=\"day-number\">${i}</span>`;\n            if (scoresByDate[dateStr]) {\n                dayContent += `<span class=\"day-score\">${scoresByDate[dateStr]}</span>`;\n            }\n            dayCell.innerHTML = dayContent;\n            if (dateStr === new Date().toISOString().split('T')[0]) {\n                dayCell.classList.add('today');\n            }\n            if (dateStr === selectedDate) {\n                dayCell.classList.add('selected-day');\n            }\n            if (!isDateEditable(dateStr)) {\n                dayCell.classList.add('uneditable-day');\n            }\n            calendarEl.appendChild(dayCell);\n        }\n    };\n    const renderPositivesForDay = async (dateStr) => {\n        positivesListEl.innerHTML = '<li>Loading...</li>';\n        const todayStr = new Date().toISOString().split('T')[0];\n        if (dateStr === todayStr) {\n            dailyLogTitleEl.textContent = \"Today's Positives\";\n        } else {\n            dailyLogTitleEl.textContent = `Positives for ${dateStr}`;\n        }\n        if (!currentUser) {\n            positivesListEl.innerHTML = '<li>Please sign in to see your positives.</li>';\n            return;\n        }\n        const dayData = await getPositivesByDate(dateStr);\n        positivesListEl.innerHTML = '';\n        if (dayData.length === 0) {\n            positivesListEl.innerHTML = '<li>No positives recorded for this day.</li>';\n            return;\n        }\n        const editable = isDateEditable(dateStr);\n        dayData.forEach(item => {\n            const li = document.createElement('li');\n            const stars = 'â˜…'.repeat(item.count);\n            li.innerHTML = `\n                <div class=\"positive-item-main\">\n                    <span class=\"positive-name\">${item.name}</span>\n                    <span class=\"positive-stars\">${stars}</span>\n                </div>\n                <div class=\"positive-item-controls\">\n                    <span class=\"difficulty-label\">Difficulty: ${item.baseScore}</span>\n                    <div class=\"score-controls\">\n                        <button data-id=\"${item.id}\" class=\"inc-btn\" ${!editable ? 'disabled' : ''}>+</button>\n                        <button data-id=\"${item.id}\" class=\"dec-btn\" ${!editable ? 'disabled' : ''}>-</button>\n                    </div>\n                </div>\n            `;\n            positivesListEl.appendChild(li);\n        });\n    };\n    const renderChart = async (range = 'week') => {\n        if (myChart) {\n            myChart.destroy();\n        }\n        const labels = [];\n        const chartData = [];\n        let maxScore = 0;\n        let legendLabel = 'Score';\n        if (currentUser) {\n            switch (range) {\n                case 'week': {\n                    legendLabel = 'Daily Score';\n                    const selected = new Date(selectedDate + 'T00:00:00Z');\n                    const dayOfWeek = selected.getUTCDay();\n                    const offset = (dayOfWeek === 0) ? 6 : dayOfWeek - 1;\n                    const startDate = new Date(selected);\n                    startDate.setUTCDate(selected.getUTCDate() - offset);\n                    const endDate = new Date(startDate);\n                    endDate.setUTCDate(startDate.getUTCDate() + 6);\n                    const startStr = startDate.toISOString().split('T')[0];\n                    const endStr = endDate.toISOString().split('T')[0];\n                    const rangePositives = await getPositivesByDateRange(startStr, endStr);\n                    const scoresByDate = {};\n                    rangePositives.forEach(p => {\n                        scoresByDate[p.date] = (scoresByDate[p.date] || 0) + p.score;\n                    });\n                    const currentDate = new Date(startDate);\n                    for (let i = 0; i < 7; i++) {\n                        const dateStr = currentDate.toISOString().split('T')[0];\n                        labels.push(currentDate.toLocaleDateString('en-US', { weekday: 'short' }));\n                        const totalScore = scoresByDate[dateStr] || 0;\n                        chartData.push(totalScore);\n                        if (totalScore > maxScore) maxScore = totalScore;\n                        currentDate.setUTCDate(currentDate.getUTCDate() + 1);\n                    }\n                    break;\n                }\n                case 'month': {\n                    legendLabel = 'Weekly Score';\n                    const year = currentYear;\n                    const month = currentMonth;\n                    const startDate = new Date(Date.UTC(year, month, 1));\n                    const endDate = new Date(Date.UTC(year, month + 1, 0));\n                    const startStr = startDate.toISOString().split('T')[0];\n                    const endStr = endDate.toISOString().split('T')[0];\n                    const rangePositives = await getPositivesByDateRange(startStr, endStr);\n                    const weeklyScores = [0, 0, 0, 0, 0];\n                    rangePositives.forEach(p => {\n                        const dayOfMonth = new Date(p.date + 'T00:00:00Z').getUTCDate();\n                        if (dayOfMonth <= 7) weeklyScores[0] += p.score;\n                        else if (dayOfMonth <= 14) weeklyScores[1] += p.score;\n                        else if (dayOfMonth <= 21) weeklyScores[2] += p.score;\n                        else if (dayOfMonth <= 28) weeklyScores[3] += p.score;\n                        else weeklyScores[4] += p.score;\n                    });\n                    labels.push('Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5+');\n                    chartData.push(...weeklyScores);\n                    maxScore = Math.max(...weeklyScores);\n                    break;\n                }\n                case 'year': {\n                    legendLabel = 'Monthly Score';\n                    const year = currentYear;\n                    const startMonth = new Date(Date.UTC(year, 0, 1));\n                    const endMonth = new Date(Date.UTC(year, 11, 31));\n                    const startStr = startMonth.toISOString().split('T')[0];\n                    const endStr = endMonth.toISOString().split('T')[0];\n                    const rangePositives = await getPositivesByDateRange(startStr, endStr);\n                    const monthlyScores = {};\n                    const monthOrder = [];\n                    for (let i = 0; i < 12; i++) {\n                        const month = new Date(startMonth);\n                        month.setUTCMonth(startMonth.getUTCMonth() + i);\n                        const monthKey = month.toISOString().slice(0, 7);\n                        labels.push(month.toLocaleString('default', { month: 'short' }));\n                        monthlyScores[monthKey] = 0;\n                        monthOrder.push(monthKey);\n                    }\n                    rangePositives.forEach(p => {\n                        const monthKey = p.date.slice(0, 7);\n                        if (monthlyScores.hasOwnProperty(monthKey)) {\n                            monthlyScores[monthKey] += p.score;\n                        }\n                    });\n                    monthOrder.forEach(monthKey => {\n                        chartData.push(monthlyScores[monthKey]);\n                    });\n                    maxScore = Math.max(...chartData);\n                    break;\n                }\n            }\n        }\n        myChart = new Chart(chartCanvas, {\n            type: 'line',\n            data: {\n                labels: labels,\n                datasets: [{\n                    label: legendLabel,\n                    data: chartData,\n                    borderColor: '#2980b9',\n                    backgroundColor: 'rgba(41, 128, 185, 0.1)',\n                    tension: 0.1,\n                    fill: true,\n                }]\n            },\n            options: {\n                scales: { y: { beginAtZero: true, max: maxScore + 5 } },\n                responsive: true,\n                maintainAspectRatio: false,\n                plugins: {\n                    legend: {\n                        labels: {\n                            pointStyle: 'line'\n                        }\n                    }\n                }\n            }\n        });\n    };\n\n    const renderVerbChart = async () => {\n        if (verbChart) {\n            verbChart.destroy();\n        }\n\n        if (!currentUser) {\n            return;\n        }\n\n        const allPositives = await getAllPositives();\n        const verbData = {};\n\n        allPositives.forEach(p => {\n            const doc = window.nlp(p.name);\n            const verbs = doc.verbs().out('array');\n            verbs.forEach(verb => {\n                if (!verbData[verb]) {\n                    verbData[verb] = { totalScore: 0, count: 0, positives: [] };\n                }\n                verbData[verb].totalScore += p.score;\n                verbData[verb].count++;\n                verbData[verb].positives.push(p.name);\n            });\n        });\n\n        const chartData = Object.keys(verbData).map(verb => ({\n            x: verbData[verb].totalScore,\n            y: verbData[verb].count,\n            r: Math.sqrt(verbData[verb].count) * 5, // Bubble radius based on count\n            verb: verb\n        }));\n\n        verbChart = new Chart(verbChartCanvas, {\n            type: 'bubble',\n            data: {\n                datasets: [{\n                    label: 'Verb Analysis (Score vs. Count)',\n                    data: chartData,\n                    backgroundColor: 'rgba(231, 76, 60, 0.5)',\n                    borderColor: '#e74c3c',\n                }]\n            },\n            options: {\n                scales: {\n                    x: {\n                        beginAtZero: true,\n                        title: {\n                            display: true,\n                            text: 'Total Score'\n                        }\n                    },\n                    y: {\n                        beginAtZero: true,\n                        title: {\n                            display: true,\n                            text: 'Number of Actions'\n                        }\n                    }\n                },\n                responsive: true,\n                maintainAspectRatio: false,\n                plugins: {\n                    tooltip: {\n                        callbacks: {\n                            label: function(context) {\n                                const dataPoint = context.raw;\n                                return `${dataPoint.verb}: ${dataPoint.y} actions, ${dataPoint.x} total score`;\n                            }\n                        }\n                    }\n                }\n            }\n        });\n    };\n\n    const populateMyTemplates = async () => {\n        if (!currentUser) return;\n        myTemplates = await getAllCustomTemplates();\n    };\n    const isDateEditable = (dateStr) => {\n        const today = new Date();\n        today.setUTCHours(0, 0, 0, 0);\n        const selected = new Date(dateStr + 'T00:00:00Z');\n        if (selected > today) {\n            return false;\n        }\n        const diffTime = today - selected;\n        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n        return diffDays <= 2;\n    };\n    const updateButtonStates = () => {\n        const editable = isDateEditable(selectedDate);\n        addPositiveBtnHome.disabled = !editable || !currentUser;\n        useTemplateBtn.disabled = !currentUser;\n    };\n    const initializeUseTemplatePage = async () => {\n        if (!currentUser) {\n            templateMasterListEl.innerHTML = '<li>Please sign in to see your templates.</li>';\n            return;\n        }\n        const allPositives = await getAllPositives();\n\n        // Calculate usage counts\n        const positiveCounts = allPositives.reduce((acc, p) => {\n            acc[p.name] = (acc[p.name] || 0) + 1;\n            return acc;\n        }, {});\n\n        const uniquePositives = [...new Map(allPositives.map(item => [item.name, item])).values()];\n        uniquePositives.forEach(p => {\n            p.usageCount = positiveCounts[p.name];\n        });\n\n        uniquePositives.sort((a, b) => b.usageCount - a.usageCount);\n\n        const renderMasterList = (filter = '') => {\n            templateMasterListEl.innerHTML = '';\n            const filteredPositives = uniquePositives.filter(p => p.name.toLowerCase().includes(filter.toLowerCase()));\n            filteredPositives.forEach(p => {\n                const li = document.createElement('li');\n                li.innerHTML = `\n                    <label>\n                        <input type=\"checkbox\" data-name=\"${p.name}\" data-score=\"${p.score}\">\n                        ${p.name} (Score: ${p.score}) - Used: ${p.usageCount} time(s)\n                    </label>`;\n                templateMasterListEl.appendChild(li);\n            });\n        };\n\n        renderMasterList(); \n\n        searchMasterListInput.addEventListener('input', () => {\n            renderMasterList(searchMasterListInput.value);\n        });\n\n        populateTemplateSelectors();\n        renderTemplateCalendar(templatePageMonth, templatePageYear);\n    };\n    const populateTemplateSelectors = () => {\n        const months = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"];\n        templateMonthSelector.innerHTML = '';\n        months.forEach((month, index) => {\n            const option = document.createElement('option');\n            option.value = index;\n            option.textContent = month;\n            templateMonthSelector.appendChild(option);\n        });\n        templateYearSelector.innerHTML = '';\n        const startYear = 2024;\n        const endYear = new Date().getFullYear() + 5;\n        for (let i = startYear; i <= endYear; i++) {\n            const option = document.createElement('option');\n            option.value = i;\n            option.textContent = i;\n            templateYearSelector.appendChild(option);\n        }\n        templateMonthSelector.value = templatePageMonth;\n        templateYearSelector.value = templatePageYear;\n    };\n    const renderTemplateCalendar = async (month, year) => {\n        templateCalendarEl.innerHTML = '';\n        const dayNames = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];\n        dayNames.forEach(day => {\n            const dayNameEl = document.createElement('div');\n            dayNameEl.textContent = day;\n            dayNameEl.classList.add('calendar-day-name');\n            templateCalendarEl.appendChild(dayNameEl);\n        });\n        const firstDay = new Date(Date.UTC(year, month, 1)).getUTCDay();\n        const emptyCells = (firstDay === 0) ? 6 : firstDay - 1;\n        for (let i = 0; i < emptyCells; i++) {\n            templateCalendarEl.appendChild(document.createElement('div'));\n        }\n        const daysInMonth = new Date(year, month + 1, 0).getDate();\n        for (let i = 1; i <= daysInMonth; i++) {\n            const dayCell = document.createElement('button');\n            dayCell.classList.add('calendar-day');\n            dayCell.textContent = i;\n            dayCell.dataset.date = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;\n            templateCalendarEl.appendChild(dayCell);\n        }\n    };\n\n    const updateUIForAuthState = async () => {\n        if (currentUser) {\n            signoutBtn.textContent = 'Sign Out';\n            await populateMyTemplates();\n        } else {\n            signoutBtn.textContent = 'Sign In';\n            myTemplates = [];\n        }\n        updateButtonStates();\n        await refreshHomePage();\n    };\n\n    // --- Initial Load ---\n    const init = async () => {\n        // Initial UI Render\n        showPage(homePage); // Make sure the home page is visible\n        document.body.classList.remove('loading');\n        populateMainSelectors();\n        await renderCalendar(currentMonth, currentYear);\n        await renderPositivesForDay(selectedDate); // Show empty state for today\n        await renderChart('week');\n        updateButtonStates(); // Set initial button states\n\n        // Authentication Handling\n        onAuthStateChange(async (user) => {\n            currentUser = user;\n            await updateUIForAuthState();\n        });\n\n        // Event Listeners\n        signoutBtn.addEventListener('click', async () => {\n            if (currentUser) {\n                await logoutUser();\n            } else {\n                window.location.href = 'login.html';\n            }\n        });\n\n        setupDropdown(positiveTemplatesInput, standardTemplatesOptions, () => standardTemplates, (value) => {\n            const hasText = value.trim() !== '';\n            positiveNameInput.disabled = hasText;\n            myPositiveTemplatesInput.disabled = hasText;\n        });\n        setupDropdown(myPositiveTemplatesInput, myTemplatesOptions, () => myTemplates, (value) => {\n            const hasText = value.trim() !== '';\n            positiveNameInput.disabled = hasText;\n            positiveTemplatesInput.disabled = hasText;\n            const selectedTemplate = myTemplates.find(t => t.name === value);\n            if (selectedTemplate) {\n                difficultySlider.value = selectedTemplate.score;\n                difficultyValue.textContent = selectedTemplate.score;\n            }\n        });\n    };\n\n    init();\n});\n","size_bytes":36421},"register.js":{"content":"import { onAuthStateChange, registerUser } from './auth.js';\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    onAuthStateChange(user => {\n        if (user) {\n            window.location.href = 'index.html';\n        }\n    });\n\n    const registerForm = document.getElementById('register-form');\n    const registerErrorEl = document.getElementById('register-error');\n\n    registerForm.addEventListener('submit', async (e) => {\n        e.preventDefault();\n        registerErrorEl.textContent = '';\n        const email = document.getElementById('register-email').value;\n        const password = document.getElementById('register-password').value;\n        const { error } = await registerUser(email, password);\n        if (error) {\n            registerErrorEl.textContent = error.message;\n        }\n    });\n});\n","size_bytes":815},"style.css":{"content":"/* General Body Styles */\nbody {\n    font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n    background-color: #f4f7f6;\n    color: #333;\n    margin: 0;\n    line-height: 1.6;\n}\n\nbody.loading main,\nbody.loading header {\n    visibility: hidden;\n}\n\n/* Header */\nheader {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    padding: 1.5rem 2rem;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n}\n\nheader h1 {\n    margin: 0;\n    font-size: 1.8rem;\n    color: #fff;\n    font-weight: 600;\n    letter-spacing: 0.5px;\n}\n\n#signout-btn {\n    background-color: #e74c3c;\n    color: white;\n    border: none;\n    padding: 0.5rem 1rem;\n    border-radius: 5px;\n    cursor: pointer;\n    transition: background-color 0.3s;\n}\n\n#signout-btn:hover {\n    background-color: #c0392b;\n}\n\n/* Main Content */\nmain {\n    padding: 2rem;\n}\n\nsection {\n    background-color: #fff;\n    padding: 2rem;\n    border-radius: 8px;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n    margin-bottom: 2rem;\n}\n\n.global-controls {\n    display: flex;\n    justify-content: center;\n    gap: 1rem;\n    margin-bottom: 1.5rem;\n}\n\n.global-controls select {\n    padding: 0.5rem 1rem;\n    font-size: 1.1rem;\n    border: 1px solid #ccc;\n    border-radius: 5px;\n    background-color: #fff;\n}\n\n.hidden {\n    display: none;\n}\n\n/* Auth Page */\n.auth-container {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 2rem;\n    max-width: 800px;\n    margin: 0 auto;\n}\n\n.auth-form {\n    padding: 1.5rem;\n    border: 1px solid #ddd;\n    border-radius: 8px;\n}\n\n.auth-form h3 {\n    margin-top: 0;\n    color: #2c3e50;\n}\n\n.auth-form button {\n    width: 100%;\n    background-color: #3498db;\n    color: white;\n    border: none;\n    padding: 0.75rem;\n    border-radius: 5px;\n    cursor: pointer;\n    font-size: 1rem;\n    transition: background-color 0.3s;\n}\n\n.auth-form button:hover {\n    background-color: #2980b9;\n}\n\n/* Calendar */\n.calendar-container {\n    margin-bottom: 2rem;\n}\n\n#calendar {\n    display: grid;\n    grid-template-columns: repeat(7, 1fr);\n    gap: 8px;\n    text-align: center;\n}\n\n.calendar-day {\n    background: #fff;\n    border: 2px solid #e8ecf1;\n    font-family: inherit;\n    cursor: pointer;\n    padding: 0.75rem;\n    border-radius: 10px;\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    gap: 0.1rem;\n    min-height: 60px;\n    transition: all 0.2s ease;\n}\n\n.calendar-day:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);\n    border-color: #667eea;\n}\n\n.day-number {\n    font-size: 1rem;\n    color: #333;\n    font-weight: 500;\n}\n\n.day-score {\n    font-size: 0.85rem;\n    font-weight: bold;\n    color: #fff;\n    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);\n    padding: 2px 8px;\n    border-radius: 12px;\n    margin-top: 3px;\n}\n\n.calendar-day.today {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n}\n\n.calendar-day.today .day-number {\n    font-weight: bold;\n    color: #fff;\n}\n\n.calendar-day.selected-day {\n    border: 3px solid #667eea;\n    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);\n}\n\n.calendar-day.uneditable-day {\n    opacity: 0.4;\n    cursor: not-allowed;\n}\n\n.calendar-day.uneditable-day:hover {\n    transform: none;\n    box-shadow: none;\n    border-color: #e8ecf1;\n}\n\n/* Auth Page */\n#auth-page {\n    max-width: 800px;\n    margin: 2rem auto;\n}\n\n.auth-container {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 2rem;\n}\n\n.auth-form h3 {\n    text-align: center;\n    margin-bottom: 1.5rem;\n}\n\n.error-message {\n    color: #e74c3c;\n    margin-top: 1rem;\n    text-align: center;\n    min-height: 1.2em; /* Reserve space to prevent layout shift */\n}\n\n.auth-switch {\n    text-align: center;\n    margin-top: 1.5rem;\n}\n\n.auth-switch a {\n    color: #3498db;\n    text-decoration: none;\n    font-weight: bold;\n}\n\n.auth-switch a:hover {\n    text-decoration: underline;\n}\n\n/* Daily Log */\n.daily-log {\n    margin-top: 2rem;\n}\n\n.daily-log-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    border-bottom: 3px solid #667eea;\n    margin-bottom: 1rem;\n    padding-bottom: 0.5rem;\n}\n\n.daily-log-header h3 {\n    color: #667eea;\n    margin: 0;\n    font-size: 1.3rem;\n    font-weight: 600;\n}\n\n.small-btn {\n    background-color: #3498db;\n    color: white;\n    border: none;\n    padding: 0.4rem 0.8rem;\n    border-radius: 5px;\n    cursor: pointer;\n    font-size: 0.9rem;\n}\n\n#positives-list {\n    list-style: none;\n    padding: 0;\n}\n\n#positives-list li {\n    display: flex;\n    flex-direction: column; /* Two-row layout */\n    padding: 0.5rem 0; /* Compact - remove horizontal padding */\n    border-bottom: 1px solid #eee;\n}\n\n#positives-list li:last-child {\n    border-bottom: none;\n}\n\n.positive-item-main {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    width: 100%;\n}\n\n.positive-name {\n    font-weight: bold;\n}\n\n.positive-stars {\n    color: #f39c12; /* Gold color for stars */\n    font-size: 1.2rem;\n}\n\n.positive-item-controls {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    width: 100%;\n    margin-top: 0.25rem;\n}\n\n.difficulty-label {\n    font-size: 0.8rem;\n    color: #7f8c8d;\n}\n\n.score-controls button {\n    background-color: #3498db;\n    color: white;\n    border: none;\n    width: 25px;\n    height: 25px;\n    border-radius: 50%;\n    cursor: pointer;\n    margin-left: 5px;\n}\n\n/* Graph */\n.graph-container {\n    margin-top: 2rem;\n    background: #f8f9fa;\n    padding: 1.5rem;\n    border-radius: 12px;\n}\n\n.graph-container h3 {\n    color: #667eea;\n    font-size: 1.3rem;\n    font-weight: 600;\n    margin-bottom: 1rem;\n}\n\n.graph-toggles {\n    margin-bottom: 1.5rem;\n    display: flex;\n    gap: 0.5rem;\n}\n\n.toggle-btn {\n    background-color: #fff;\n    border: 2px solid #e8ecf1;\n    padding: 0.6rem 1.5rem;\n    cursor: pointer;\n    border-radius: 25px;\n    font-weight: 500;\n    transition: all 0.2s ease;\n    color: #666;\n}\n\n.toggle-btn:hover {\n    border-color: #667eea;\n    color: #667eea;\n    transform: translateY(-1px);\n}\n\n.toggle-btn.active {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n    border-color: transparent;\n    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);\n}\n\n.chart-wrapper {\n    position: relative;\n    height: 350px;\n    width: 100%;\n    background: #fff;\n    border-radius: 10px;\n    padding: 1rem;\n}\n\n/* Add Positive Button */\n.add-positive-btn {\n    position: fixed;\n    bottom: 2rem;\n    right: 2rem;\n    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);\n    color: white;\n    border: none;\n    width: 65px;\n    height: 65px;\n    border-radius: 50%;\n    font-size: 2rem;\n    box-shadow: 0 6px 20px rgba(56, 239, 125, 0.4);\n    transition: all 0.3s ease;\n    cursor: pointer;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n\n.add-positive-btn:hover {\n    transform: scale(1.1) rotate(90deg);\n    box-shadow: 0 8px 25px rgba(56, 239, 125, 0.6);\n}\n\n/* Add Positive Page Form */\n#add-positive-page h2 {\n    color: #2980b9;\n    text-align: center;\n    margin-bottom: 2rem;\n}\n\n.form-group {\n    margin-bottom: 1.5rem;\n}\n\n.form-group label {\n    display: block;\n    margin-bottom: 0.5rem;\n    font-weight: bold;\n}\n\n.custom-dropdown-container {\n    position: relative;\n}\n\n.custom-dropdown-options {\n    display: none; /* Hidden by default */\n    position: absolute;\n    top: 100%;\n    left: 0;\n    right: 0;\n    background-color: white;\n    border: 1px solid #ccc;\n    border-top: none;\n    border-radius: 0 0 5px 5px;\n    max-height: 200px;\n    overflow-y: auto;\n    z-index: 1000;\n}\n\n.custom-dropdown-options.visible {\n    display: block;\n}\n\n.dropdown-option {\n    padding: 0.8rem;\n    cursor: pointer;\n    display: block;\n}\n\n.dropdown-option:hover {\n    background-color: #f4f7f6;\n}\n\n.form-group input[type=\"text\"], .form-group input[type=\"range\"] {\n    width: 100%;\n    padding: 0.8rem;\n    border: 1px solid #ccc;\n    border-radius: 5px;\n    box-sizing: border-box;\n}\n\n.form-group {\n    position: relative; /* Needed for tooltip positioning */\n}\n\n.help-icon {\n    display: inline-block;\n    width: 20px;\n    height: 20px;\n    background-color: #3498db;\n    color: white;\n    border-radius: 50%;\n    text-align: center;\n    line-height: 20px;\n    cursor: pointer;\n    margin-left: 10px;\n    font-weight: bold;\n}\n\n.tooltip {\n    display: none; /* Hidden by default */\n    position: absolute;\n    top: 0;\n    left: calc(100% + 15px); /* Position to the right of the form group */\n    width: 300px;\n    background-color: #fff;\n    border: 1px solid #ccc;\n    border-radius: 8px;\n    padding: 1rem;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n    z-index: 100;\n}\n\n.tooltip.visible {\n    display: block;\n}\n\n.tooltip p {\n    margin: 0 0 0.5rem 0;\n}\n\n.close-tooltip {\n    position: absolute;\n    top: 10px;\n    right: 15px;\n    font-size: 1.5rem;\n    font-weight: bold;\n    color: #aaa;\n    cursor: pointer;\n}\n\n.close-tooltip:hover {\n    color: #333;\n}\n\n.form-buttons {\n    display: flex;\n    justify-content: flex-end;\n    gap: 1rem;\n    margin-top: 2rem;\n}\n\n.form-buttons button {\n    padding: 0.8rem 1.5rem;\n    border: none;\n    border-radius: 5px;\n    cursor: pointer;\n    font-size: 1rem;\n}\n\n#save-positive-btn {\n    background-color: #27ae60;\n    color: white;\n}\n\n#save-template-btn {\n    background-color: #2980b9;\n    color: white;\n}\n\n#cancel-positive-btn {\n    background-color: #bdc3c7;\n}\n\n/* Use Template Page */\n#use-template-page h2 {\n    color: #2980b9;\n    text-align: center;\n    margin-bottom: 2rem;\n}\n\n.use-template-container {\n    display: flex;\n    gap: 2rem;\n    align-items: flex-start;\n}\n\n.template-source-container {\n    flex: 1;\n    background-color: #f8f9fa;\n    padding: 1.5rem;\n    border-radius: 8px;\n    display: flex;\n    flex-direction: column;\n}\n\n.template-source-container h3 {\n    margin-top: 0;\n    color: #2c3e50;\n}\n\n.template-source-container #template-calendar {\n    display: grid;\n    grid-template-columns: repeat(7, 1fr);\n    gap: 2px;\n    text-align: center;\n    margin-bottom: 1rem;\n}\n\n#template-calendar .calendar-day-name {\n    font-size: 0.8rem;\n    font-weight: bold;\n}\n\n#template-calendar .calendar-day {\n    padding: 0.4rem;\n    font-size: 0.8rem;\n    gap: 2px;\n}\n\n.template-day-controls {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 1rem;\n}\n\n.template-day-positives, #template-master-list {\n    list-style: none;\n    padding: 0;\n}\n\n#template-day-positives-list li, #template-master-list li {\n    padding: 0.5rem;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n/* Responsive Mobile View */\n@media (max-width: 768px) {\n    main {\n        padding: 1rem;\n    }\n\n    .calendar-container {\n        width: 100%;\n        margin: 0 auto 2rem auto;\n    }\n\n    #calendar .calendar-day {\n        padding: 0.5rem 0.2rem;\n        font-size: 0.8rem;\n    }\n\n    #calendar .calendar-day-name {\n        font-size: 0.8rem;\n    }\n\n    .use-template-container {\n        flex-direction: column;\n    }\n\n    .tooltip {\n        left: 50%;\n        top: 50%;\n        transform: translate(-50%, -50%);\n        width: 90%;\n        max-width: 400px;\n    }\n}\n","size_bytes":11300},"firebase-config.js":{"content":"// Your web app's Firebase configuration\n// For Firebase JS SDK v7.20.0 and later, measurementId is optional\nconst firebaseConfig = {\n  apiKey: \"AIzaSyA_auTXFhXrjbXGFrwASelGIpC0WQfN5Yc\",\n  authDomain: \"self-affirmation-dd4bb.firebaseapp.com\",\n  projectId: \"self-affirmation-dd4bb\",\n  storageBucket: \"self-affirmation-dd4bb.firebasestorage.app\",\n  messagingSenderId: \"347544958226\",\n  appId: \"1:347544958226:web:927f44635a50ef10a8afcb\",\n  measurementId: \"G-92NR78NR0T\"\n};\n\nexport { firebaseConfig };\n","size_bytes":499},"login.js":{"content":"import { onAuthStateChange, loginUser } from './auth.js';\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    onAuthStateChange(user => {\n        if (user) {\n            window.location.href = 'index.html';\n        }\n    });\n\n    const loginForm = document.getElementById('login-form');\n    const loginErrorEl = document.getElementById('login-error');\n\n    loginForm.addEventListener('submit', async (e) => {\n        e.preventDefault();\n        loginErrorEl.textContent = '';\n        const email = document.getElementById('login-email').value;\n        const password = document.getElementById('login-password').value;\n        const { error } = await loginUser(email, password);\n        if (error) {\n            loginErrorEl.textContent = error.message;\n        }\n    });\n});\n","size_bytes":782},"auth.js":{"content":"// Import the functions you need from the SDKs you need\nimport { initializeApp } from \"https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js\";\nimport { getAnalytics } from \"https://www.gstatic.com/firebasejs/9.6.10/firebase-analytics.js\";\nimport { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from \"https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js\";\nimport { getFirestore, doc, setDoc, getDoc, collection, addDoc, getDocs, updateDoc, deleteDoc, query, where } from \"https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js\";\nimport { firebaseConfig } from './firebase-config.js';\n\n// --- IMPORTANT ---\n// For a production environment, ensure you have set up Firestore Security Rules\n// to restrict data access. Users should only be able to read/write their own data.\n// Example Rule:\n// match /users/{userId}/{documents=**} {\n//   allow read, write: if request.auth.uid == userId;\n// }\n// ---------------\n\n// Initialize Firebase\nconst app = initializeApp(firebaseConfig);\nconst analytics = getAnalytics(app);\nconst auth = getAuth(app);\nconst db = getFirestore(app);\n\n// --- Authentication ---\nconst registerUser = async (email, password) => {\n    try {\n        const userCredential = await createUserWithEmailAndPassword(auth, email, password);\n        const user = userCredential.user;\n        await setDoc(doc(db, \"users\", user.uid), {\n            email: user.email,\n        });\n        return { user };\n    } catch (error) {\n        return { error };\n    }\n};\n\nconst loginUser = async (email, password) => {\n    try {\n        const userCredential = await signInWithEmailAndPassword(auth, email, password);\n        return { user: userCredential.user };\n    } catch (error) {\n        return { error };\n    }\n};\n\nconst logoutUser = async () => {\n    try {\n        await signOut(auth);\n        window.location.href = 'login.html';\n        return { success: true };\n    } catch (error) {\n        return { error };\n    }\n};\n\nconst onAuthStateChange = (callback) => {\n    return onAuthStateChanged(auth, callback);\n};\n\n// --- Firestore Database ---\nconst getCurrentUser = () => {\n    return auth.currentUser;\n};\n\nconst addPositive = async (positive, retries = 3) => {\n    const user = getCurrentUser();\n    if (!user) return { error: 'User not logged in' };\n\n    for (let i = 0; i < retries; i++) {\n        try {\n            const docRef = await addDoc(collection(db, \"users\", user.uid, \"positives\"), positive);\n            const newPositive = { id: docRef.id, ...positive };\n            return newPositive;\n        } catch (error) {\n            console.error(`Attempt ${i + 1} to add positive failed:`, error);\n            if (i === retries - 1) {\n                return { error: 'Failed to add positive after multiple retries.' };\n            }\n            // Wait for a short period before retrying\n            await new Promise(res => setTimeout(res, 1000));\n        }\n    }\n};\n\nconst getAllPositives = async () => {\n    const user = getCurrentUser();\n    if (!user) return [];\n    const querySnapshot = await getDocs(collection(db, \"users\", user.uid, \"positives\"));\n    const positives = [];\n    querySnapshot.forEach((doc) => {\n        positives.push({ id: doc.id, ...doc.data() });\n    });\n    return positives;\n};\n\nconst getPositiveById = async (id) => {\n    const user = getCurrentUser();\n    if (!user) return null;\n    const docRef = doc(db, \"users\", user.uid, \"positives\", id);\n    const docSnap = await getDoc(docRef);\n    return docSnap.exists() ? { id: docSnap.id, ...docSnap.data() } : null;\n};\n\nconst getPositivesByDate = async (dateStr) => {\n    const user = getCurrentUser();\n    if (!user) return [];\n    const q = query(collection(db, \"users\", user.uid, \"positives\"), where(\"date\", \"==\", dateStr));\n    const querySnapshot = await getDocs(q);\n    const positives = [];\n    querySnapshot.forEach((doc) => {\n        positives.push({ id: doc.id, ...doc.data() });\n    });\n    return positives;\n};\n\nconst getPositivesByDateRange = async (startDate, endDate) => {\n    const user = getCurrentUser();\n    if (!user) return [];\n    const q = query(collection(db, \"users\", user.uid, \"positives\"), where(\"date\", \">=\", startDate), where(\"date\", \"<=\", endDate));\n    const querySnapshot = await getDocs(q);\n    const positives = [];\n    querySnapshot.forEach((doc) => {\n        positives.push({ id: doc.id, ...doc.data() });\n    });\n    return positives;\n};\n\nconst updatePositive = async (positive) => {\n    const user = getCurrentUser();\n    if (!user) return;\n    const { id, ...data } = positive;\n    const docRef = doc(db, \"users\", user.uid, \"positives\", id);\n    await updateDoc(docRef, data);\n};\n\nconst deletePositive = async (id) => {\n    const user = getCurrentUser();\n    if (!user) return;\n    await deleteDoc(doc(db, \"users\", user.uid, \"positives\", id));\n};\n\nconst addCustomTemplate = async (template) => {\n    const user = getCurrentUser();\n    if (!user) return { error: 'User not logged in' };\n    const docRef = await addDoc(collection(db, \"users\", user.uid, \"custom_templates\"), template);\n    return { id: docRef.id };\n};\n\nconst getAllCustomTemplates = async () => {\n    const user = getCurrentUser();\n    if (!user) return [];\n    const querySnapshot = await getDocs(collection(db, \"users\", user.uid, \"custom_templates\"));\n    const templates = [];\n    querySnapshot.forEach((doc) => {\n        templates.push({ id: doc.id, ...doc.data() });\n    });\n    return templates;\n};\n\nconst getCustomTemplateByName = async (name) => {\n    const user = getCurrentUser();\n    if (!user) return null;\n    const q = query(collection(db, \"users\", user.uid, \"custom_templates\"), where(\"name\", \"==\", name));\n    const querySnapshot = await getDocs(q);\n    if (!querySnapshot.empty) {\n        const doc = querySnapshot.docs[0];\n        return { id: doc.id, ...doc.data() };\n    }\n    return null;\n};\n\nconst updateCustomTemplate = async (template) => {\n    const user = getCurrentUser();\n    if (!user) return;\n    const { id, ...data } = template;\n    const docRef = doc(db, \"users\", user.uid, \"custom_templates\", id);\n    await updateDoc(docRef, data);\n};\n\nconst deleteCustomTemplate = async (id) => {\n    const user = getCurrentUser();\n    if (!user) return;\n    await deleteDoc(doc(db, \"users\", user.uid, \"custom_templates\", id));\n};\n\nexport {\n    auth,\n    db,\n    registerUser,\n    loginUser,\n    logoutUser,\n    onAuthStateChange,\n    getCurrentUser,\n    addPositive,\n    getAllPositives,\n    getPositiveById,\n    getPositivesByDate,\n    getPositivesByDateRange,\n    updatePositive,\n    deletePositive,\n    addCustomTemplate,\n    getAllCustomTemplates,\n    getCustomTemplateByName,\n    updateCustomTemplate,\n    deleteCustomTemplate,\n};\n","size_bytes":6723}},"version":2}